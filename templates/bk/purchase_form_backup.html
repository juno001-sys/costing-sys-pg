<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>取引データ入力（納品書）</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 20px; }
    label { display: inline-block; width: 100px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 4px 6px; }
    th { background: #f5f5f5; }
    input[type="number"] { width: 80px; text-align: right; }
    select, input[type="text"], input[type="date"] { padding: 2px 4px; }
    .flash { color: darkred; margin-bottom: 10px; }
  </style>
</head>
<body>
  <h1>取引データ入力（納品書）</h1>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flash">
        {% for msg in messages %}
          <div>{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <form method="post" action="{{ url_for('new_purchase') }}">
    <fieldset>
      <legend>ヘッダ</legend>

      <p>
        <label for="store_id">店舗</label>
        <select name="store_id" id="store_id" required>
          <option value="">--選択--</option>
          {% for s in stores %}
            <option value="{{ s['id'] }}">{{ s['id'] }}: {{ s['name'] }}</option>
          {% endfor %}
        </select>
      </p>

      <p>
        <label for="supplier_id">仕入先</label>
        <select name="supplier_id" id="supplier_id" required>
          <option value="">--選択--</option>
          {% for sup in suppliers %}
            <option value="{{ sup['id'] }}">{{ sup['name'] }}</option>
          {% endfor %}
        </select>
      </p>

      <p>
        <label for="delivery_date">納品日</label>
        <input type="date" name="delivery_date" id="delivery_date"
               value="{{ today }}" required>
      </p>

      <p>
        <label for="slip_no">納品書番号</label>
        <input type="text" name="slip_no" id="slip_no" required>
      </p>
    </fieldset>

    <fieldset>
      <legend>明細（最大5行）</legend>

      <table>
        <thead>
          <tr>
            <th style="width: 5%;">#</th>
            <th style="width: 40%;">品目</th>
            <th style="width: 15%;">数量</th>
            <th style="width: 15%;">単価</th>
          </tr>
        </thead>
        <tbody>
          {% for i in range(1, 6) %}
          <tr>
            <td>{{ i }}</td>
            <td>
              <select name="item_id_{{ i }}">
                <option value="">--選択--</option>
                {% for item in items %}
                  <option value="{{ item['id'] }}">{{ item['name'] }}</option>
                {% endfor %}
              </select>
            </td>
            <td>
              <input type="number" step="0.01" name="quantity_{{ i }}">
            </td>
            <td>
              <input type="number" step="0.01" name="unit_price_{{ i }}">
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </fieldset>

    <p style="margin-top: 10px;">
      <button type="submit">登録する</button>
    </p>
  </form>
</body>
</html>
