{% extends "base.html" %}

{% block title %}月次利用量レポート{% endblock %}

{% block content %}
  <h2>月次利用量レポート（仕入＋棚卸ベース）</h2>

  <form method="get">
    <label>店舗：</label>
    <select name="store_id" onchange="this.form.submit()">
      <option value="">（全店舗）</option>
      {% for s in stores %}
        <option value="{{ s.id }}" {% if selected_store_id == s.id %}selected{% endif %}>
          {{ s.name }}
        </option>
      {% endfor %}
    </select>
    <noscript><button type="submit">表示</button></noscript>
  </form>

  <table border="1" cellpadding="4" cellspacing="0" style="margin-top: 12px;">
    <thead>
      <tr>
        <th rowspan="2">コード</th>
        <th rowspan="2">品目名</th>
        {% for ym in month_keys %}
          <th colspan="4">{{ ym }}</th>
        {% endfor %}
        <th colspan="3">合計</th>
      </tr>
      <tr>
        {% for ym in month_keys %}
          <th>期首</th>
          <th>仕入</th>
          <th>期末</th>
          <th>利用</th>
        {% endfor %}
        <th>仕入</th>
        <th>利用</th>
        <th>期末</th>
      </tr>
    </thead>
    <tbody>
      {% for it in item_rows %}
        <tr>
          <td>{{ it.item_code }}</td>
          <td>{{ it.item_name }}</td>
          {% for ym in month_keys %}
            {% set d = it.per_month[ym] %}
            <td style="text-align:right;">{{ d.begin_qty }}</td>
            <td style="text-align:right;">{{ d.pur_qty }}</td>
            <td style="text-align:right;">{{ d.end_qty }}</td>
            <td style="text-align:right;">{{ d.used_qty }}</td>
          {% endfor %}
          <td style="text-align:right;">{{ it.total_pur }}</td>
          <td style="text-align:right;">{{ it.total_used }}</td>
          <td style="text-align:right;">{{ it.total_end }}</td>
        </tr>
      {% else %}
        <tr>
          <td colspan="{{ 2 + month_keys|length * 4 + 3 }}">データがありません。</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
