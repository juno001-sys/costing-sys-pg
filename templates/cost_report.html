{% extends "base.html" %}

{% block title %}売上原価 月次推移{% endblock %}

{% block content %}

  <form method="get" style="margin-bottom: 16px;">
    <label>
      店舗：
      <select name="store_id">
        <option value="">（全店舗）</option>
        {% for s in stores %}
          <option value="{{ s.id }}"
                  {% if selected_store_id == s.id %}selected{% endif %}>
            {{ s.name }}
          </option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">表示</button>
  </form>

  <table class="monthly-table">
    <thead>
      <tr>
        <th>区分</th>
        {% for ym in month_keys %}
          <th>{{ ym }}</th>
        {% endfor %}
        <th>合計</th>
      </tr>
    </thead>
    <tbody>
      {# 期首繰越 #}
      <tr>
        <td>期首繰越</td>
        {% for ym in month_keys %}
          {% set v = beg_inv_by_month[ym] %}
          <td class="num">
            {% if v %}
              {{ "{:,}".format(v|float|round(0)|int) }}
            {% endif %}
          </td>
        {% endfor %}
        <td class="num">
          {% if beg_inv_total %}
            {{ "{:,}".format(beg_inv_total|float|round(0)|int) }}
          {% endif %}
        </td>
      </tr>

      {# 仕入額 #}
      <tr>
        <td>仕入額</td>
        {% for ym in month_keys %}
          {% set v = purchases_by_month[ym] %}
          <td class="num">
            {% if v %}
              {{ "{:,}".format(v|float|round(0)|int) }}
            {% endif %}
          </td>
        {% endfor %}
        <td class="num">
          {% if purchases_total %}
            {{ "{:,}".format(purchases_total|float|round(0)|int) }}
          {% endif %}
        </td>
      </tr>

      {# 売上原価（強調行） #}
      <tr class="cogs-row">
        <td>売上原価</td>
        {% for ym in month_keys %}
          {% set v = cogs_by_month[ym] %}
          <td class="num">
            {% if v %}
              {{ "{:,}".format(v|float|round(0)|int) }}
            {% endif %}
          </td>
        {% endfor %}
        <td class="num">
          {% if cogs_total %}
            {{ "{:,}".format(cogs_total|float|round(0)|int) }}
          {% endif %}
        </td>
      </tr>

      {# 月末棚卸し #}
      <tr>
        <td>月末棚卸し</td>
        {% for ym in month_keys %}
          {% set v = end_inv_by_month[ym] %}
          <td class="num">
            {% if v %}
              {{ "{:,}".format(v|float|round(0)|int) }}
            {% endif %}
          </td>
        {% endfor %}
        <td class="num">
          {% if end_inv_total %}
            {{ "{:,}".format(end_inv_total|float|round(0)|int) }}
          {% endif %}
        </td>
      </tr>
    </tbody>
  </table>
{% endblock %}
