{% extends "base.html" %}

{% block title %}{{ t("report.cost.title") }}{% endblock %}

{% block content %}

  <form method="get" style="margin-bottom: 16px;">
    <label>
      {{ t("form.store") }}：
      <select name="store_id">
        <option value="">{{ t("common.all") }}</option>
        {% for s in stores %}
          <option value="{{ s.id }}"
                  {% if selected_store_id == s.id %}selected{% endif %}>
            {{ s.name }}
          </option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">{{ t("form.show") }}</button>
  </form>

  <table class="monthly-table">
    <thead>
      <tr>
        <th>{{ t("cost.category") }}</th>
        {% for ym in month_keys %}
          <th>{{ ym }}</th>
        {% endfor %}
        <th>{{ t("common.total") }}</th>
      </tr>
    </thead>

    <tbody>

      <!-- 期首繰越 -->
      <tr>
        <td>{{ t("cost.begin_inventory") }}</td>
        {% for ym in month_keys %}
          {% set v = beg_inv_by_month[ym] %}
          <td class="num">
            {% if v %}
              {{ "{:,}".format(v|float|round(0)|int) }}
            {% endif %}
          </td>
        {% endfor %}
        <td class="num">
          {% if beg_inv_total %}
            {{ "{:,}".format(beg_inv_total|float|round(0)|int) }}
          {% endif %}
        </td>
      </tr>

      <!-- 仕入額 -->
      <tr>
        <td>{{ t("cost.purchase_amount") }}</td>
        {% for ym in month_keys %}
          {% set v = purchases_by_month[ym] %}
          <td class="num">
            {% if v %}
              {{ "{:,}".format(v|float|round(0)|int) }}
            {% endif %}
          </td>
        {% endfor %}
        <td class="num">
          {% if purchases_total %}
            {{ "{:,}".format(purchases_total|float|round(0)|int) }}
          {% endif %}
        </td>
      </tr>

      <!-- 売上原価（強調行） -->
      <tr class="cogs-row">
        <td>{{ t("cost.cogs") }}</td>
        {% for ym in month_keys %}
          {% set v = cogs_by_month[ym] %}
          <td class="num">
            {% if v %}
              {{ "{:,}".format(v|float|round(0)|int) }}
            {% endif %}
          </td>
        {% endfor %}
        <td class="num">
          {% if cogs_total %}
            {{ "{:,}".format(cogs_total|float|round(0)|int) }}
          {% endif %}
        </td>
      </tr>

      <!-- 月末棚卸し -->
      <tr>
        <td>{{ t("cost.ending_inventory") }}</td>
        {% for ym in month_keys %}
          {% set v = end_inv_by_month[ym] %}
          <td class="num">
            {% if v %}
              {{ "{:,}".format(v|float|round(0)|int) }}
            {% endif %}
          </td>
        {% endfor %}
        <td class="num">
          {% if end_inv_total %}
            {{ "{:,}".format(end_inv_total|float|round(0)|int) }}
          {% endif %}
        </td>
      </tr>

    </tbody>

  </table>
{% endblock %}
