{% extends "base.html" %}

{% block title %}売上原価 月次推移{% endblock %}

{% block content %}
  <h2>売上原価 月次推移</h2>

  <form method="get" style="margin-bottom: 16px;">
    <label>
      店舗：
      <select name="store_id">
        <option value="">（全店舗）</option>
        {% for s in stores %}
          <option value="{{ s.id }}"
                  {% if selected_store_id == s.id %}selected{% endif %}>
            {{ s.name }}
          </option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">表示</button>
  </form>

  <table class="monthly-table">
    <thead>
      <tr>
        <th>区分</th>
        {% for ym in month_keys %}
          <th>{{ ym }}</th>
        {% endfor %}
        <th>合計</th>
      </tr>
    </thead>
    <tbody>
      {# 期首繰越 #}
      <tr>
        <td>期首繰越</td>
        {% for ym in month_keys %}
          {% set v = beg_inv_by_month[ym] %}
          <td>
            {{ "{:,}".format(v|round|int) if v else "" }}
          </td>
        {% endfor %}
        <td>
          {{ "{:,}".format(beg_inv_total|round|int) if beg_inv_total else "" }}
        </td>
      </tr>

      {# 仕入額 #}
      <tr>
        <td>仕入額</td>
        {% for ym in month_keys %}
          {% set v = purchases_by_month[ym] %}
          <td>
            {{ "{:,}".format(v|round|int) if v else "" }}
          </td>
        {% endfor %}
        <td>
          {{ "{:,}".format(purchases_total|round|int) if purchases_total else "" }}
        </td>
      </tr>

      {# 売上原価（強調行） #}
      <tr class="row-cogs">
        <td>売上原価</td>
        {% for ym in month_keys %}
          {% set v = cogs_by_month[ym] %}
          <td>
            {{ "{:,}".format(v|round|int) if v else "" }}
          </td>
        {% endfor %}
        <td>
          {{ "{:,}".format(cogs_total|round|int) if cogs_total else "" }}
        </td>
      </tr>

      {# 月末棚卸し #}
      <tr>
        <td>月末棚卸し</td>
        {% for ym in month_keys %}
          {% set v = end_inv_by_month[ym] %}
          <td>
            {{ "{:,}".format(v|round|int) if v else "" }}
          </td>
        {% endfor %}
        <td>
          {{ "{:,}".format(end_inv_total|round|int) if end_inv_total else "" }}
        </td>
      </tr>
    </tbody>
  </table>
{% endblock %}
