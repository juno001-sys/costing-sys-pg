{% extends "base.html" %}

{% block title %}月次利用量（仕入＋棚卸別計算）{% endblock %}

{% block content %}
  

  <form method="get">
    <label>店舗：</label>
    <select name="store_id" onchange="this.form.submit()">
      <option value="">（全店舗）</option>
      {% for s in stores %}
        <option value="{{ s.id }}" {% if selected_store_id == s.id %}selected{% endif %}>
          {{ s.name }}
        </option>
      {% endfor %}
    </select>
    <noscript><button type="submit">表示</button></noscript>
  </form>

  <table class="monthly-table usage-table" style="margin-top: 12px;">
  <thead>
    <tr>
      <th>品目名</th>
      {% for ym in month_keys %}
        <th>{{ ym }} 仕入</th>
        <th>{{ ym }} 利用</th>
      {% endfor %}
      <th>合計仕入</th>
      <th>合計利用</th>
    </tr>
  </thead>

  <tbody>
    {% for item in item_rows %}
      <tr class="row-metric-pur item-start">
        <td rowspan="3">{{ item.item_name }}</td>
        <td class="metric-label">当月仕入数</td>
        {% for ym in month_keys %}
          <td class="num">{{ item.per_month[ym].pur_qty }}</td>
        {% endfor %}
        <td class="num">{{ item.total_pur }}</td>
      </tr>

      <tr class="row-metric-use">
        <td class="metric-label">利用数</td>
        {% for ym in month_keys %}
          <td class="num">{{ item.per_month[ym].used_qty }}</td>
        {% endfor %}
        <td class="num">{{ item.total_used }}</td>
      </tr>

      <tr class="row-metric-stock">
        <td class="metric-label">月末在庫</td>
        {% for ym in month_keys %}
          <td class="num">{{ item.per_month[ym].end_qty }}</td>
        {% endfor %}
        <td class="num">{{ item.total_end }}</td>
      </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
